
--Question 2 

--Load data with data types assigned to each column.

data = lOAD 'bank-full.csv' USING PigStorage(';')AS (age:chararray, job:chararray, marital:chararray, education:chararray, default:chararray, balance:chararray, housing:chararray, loan:chararray, contact:chararray, day:int, month:chararray, duration:chararray, campaign:int, pdays:chararray, previous:chararray, poutcome:chararray, y:chararray);

--Remove any duplicate values

data = DISTINCT data;


--Create the relation relation1 selecting day, month, poutcome columns.

relation1 = FOREACH data GENERATE day, month, poutcome;


--Filter for only the successful outcomes for the relation filtered.

filtered = FILTER relation1 BY poutcome=='"success"';



--Split the successful calls into different quarters of the year.


SPLIT filtered INTO 
	Q1 IF month=='"jan"' OR  month=='"feb"' OR month=='"mar"', 
	Q2 IF month=='"apr"' OR month=='"may"' OR month=='"jun"', 
	Q3 IF month=='"jul"' OR month=='"aug"' OR month=='"sep"', 
	Q4 IF month=='"oct"' OR month=='"nov"' OR month=='"dec"';



--Quarter 1

--Group the quarter 1 relation by all to allow for a count calculation 

quarter1grouped = GROUP Q1 ALL;

--Generate a count of the total successful calls for quarter 1

quarter1 = FOREACH quarter1grouped GENERATE group, COUNT(Q1.poutcome) AS counts1;




--Quarter 2 

--Group the quarter 2 relation by all to allow for a count calculation 

quarter2grouped = GROUP Q2 ALL;

--Generate a count of the total successful calls for quarter 2

quarter2 = FOREACH quarter2grouped GENERATE group, COUNT(Q2.poutcome) AS counts2;




--Quarter 3

--Group the quarter 3 relation by all to allow for a count calculation 

quarter3grouped = GROUP Q3 ALL;

--Generate a count of the total successful calls for quarter 3

quarter3 = FOREACH quarter3grouped GENERATE group, COUNT(Q3.poutcome) AS counts3;






--Quarter 4

--Group the quarter 3 relation by all to allow for a count calculation 

quarter4grouped = GROUP Q4 ALL;

--Generate a count of the total successful calls for quarter 4

quarter4 = FOREACH quarter4grouped GENERATE group, COUNT(Q4.poutcome) AS counts4;




--Show the number of successful calls within the Quarters


DUMP quarter1;

DUMP quarter2;

DUMP quarter3;

DUMP quarter4;


--The Most Successful Month

--Group by quarter to find the top month of successful calls.

monthfiltered = GROUP filtered BY month;

--Generate a count of the total successful calls per month

monthfiltered = FOREACH monthfiltered GENERATE group, COUNT(filtered.poutcome) AS counts;

ordered = ORDER monthfiltered BY counts DESC;

DUMP ordered;




